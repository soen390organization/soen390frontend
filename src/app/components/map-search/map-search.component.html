<div
  [ngClass]="{ 'centered-mobile': isSearchVisible }"
  class="absolute top-[24px] max-w-[410px] right-[10px] z-[999]"
  [ngStyle]="{ width: isSearchVisible ? '95%' : 'auto' }"
>
  <div
    class="rounded-3xl flex text-black bg-white shadow-lg p-2 pb-3 relative"
    [ngStyle]="{ height: isSearchVisible ? 'auto' : '48px' }"
  >
    <div
      (click)="toggleSearch()"
      (keydown.enter)="toggleSearch()"
      [ngStyle]="{ 'margin-top': isSearchVisible ? '10px' : '0' }"
    >
      <span
        class="material-symbols-outlined rounded-full p-1 cursor-pointer"
        [ngStyle]="{ 'padding-right': isSearchVisible ? '10px' : '4px' }"
      >
        {{ isSearchVisible ? 'arrow_back' : 'search' }}
      </span>
    </div>

    <div
      [@slideInOut]="isSearchVisible ? 'in' : 'out'"
      [ngStyle]="{
        height: isSearchVisible ? 'auto' : '0',
        overflow: isSearchVisible ? 'visible' : 'hidden'
      }"
      class="w-full space-y-2"
    >
      <!-- Start Input Section -->
      <div class="relative">
        <input
          [(ngModel)]="startLocationInput"
          (focus)="onFocus('start')"
          (blur)="onStartBlur()"
          (input)="onSearchChange($event, 'start')"
          (keyup.enter)="setStart(startPlaces[0]); clearStartList()"
          type="text"
          placeholder="Choose starting point..."
          debounce="1000"
          class="w-full bg-white px-4 py-3 pr-10 rounded-full border border-gray-300 focus:outline-none"
        />
        <div class="absolute inset-y-0 right-2 flex items-center">
          <ng-container *ngIf="startLocationInput && startLocationInput.trim().length > 0">
            <button (click)="clearStartInput()">
              <span class="material-symbols-outlined text-gray-400 p-2">cancel</span>
            </button>
          </ng-container>
        </div>
        <div *ngIf="startPlaces?.length > 0" class="absolute left-0 w-full top-full mt-2 z-20">
          <ul class="rounded-xl border border-gray-300 bg-white">
            <li
              *ngFor="let place of startPlaces"
              (click)="setStart(place); clearStartList()"
              (keydown.enter)="setStart(place); clearStartList()"
              [ngClass]="{ 'bg-red-50': place.isYourLocation }"
              class="flex items-center hover:bg-gray-100 p-3 cursor-pointer"
            >
              <span
                *ngIf="place.isYourLocation; else defaultIconStart"
                class="material-symbols-outlined mr-3 p-2 bg-[#912338] rounded-full text-white"
              >
                my_location
              </span>
              <ng-template #defaultIconStart>
                <span
                  class="material-symbols-outlined mr-3 p-2 border border-gray-300 rounded-full"
                  [ngClass]="{ 'text-white border-transparent': isHighlighted(place?.title) }"
                  [ngStyle]="isHighlighted(place?.title) ? { 'background-color': '#852C3A' } : {}"
                >
                  {{ getPlaceIcon(place?.title) }}
                </span>
              </ng-template>
              <div class="flex flex-col min-w-0">
                <div>{{ place?.title }}</div>
                <div class="text-sm text-gray-500 truncate">{{ place?.address }}</div>
              </div>
              <span class="material-symbols-outlined ml-auto p-2 text-[#912338]">arrow_insert</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Destination Input Section -->
      <div class="relative z-10">
        <input
          [(ngModel)]="destinationLocationInput"
          (focus)="onFocus('destination')"
          (blur)="onDestinationBlur()"
          (input)="onSearchChange($event, 'destination')"
          (keyup.enter)="setDestination(destinationPlaces[0]); clearDestinationList()"
          type="text"
          placeholder="Choose destination point..."
          class="w-full bg-white px-4 py-3 pr-10 rounded-full border border-gray-300 focus:outline-none"
        />
        <div class="absolute inset-y-0 right-2 flex items-center">
          <ng-container
            *ngIf="destinationLocationInput && destinationLocationInput.trim().length > 0"
          >
            <button (click)="clearDestinationInput()">
              <span class="material-symbols-outlined text-gray-400 p-2">cancel</span>
            </button>
          </ng-container>
        </div>
        <div *ngIf="destinationPlaces?.length > 0" class="absolute left-0 w-full top-full mt-2">
          <ul class="rounded-xl border border-gray-300 bg-white">
            <li
              *ngFor="let place of destinationPlaces"
              (click)="setDestination(place); clearDestinationList()"
              (keydown.enter)="setDestination(place); clearDestinationList()"
              [ngClass]="{ 'bg-red-50': place.isYourLocation }"
              class="flex items-center hover:bg-gray-100 p-3 cursor-pointer"
            >
              <span
                *ngIf="place.isYourLocation; else defaultIconDest"
                class="material-symbols-outlined mr-3 p-2 bg-[#912338] rounded-full text-white"
              >
                my_location
              </span>
              <ng-template #defaultIconDest>
                <span
                  class="material-symbols-outlined mr-3 p-2 border border-gray-300 rounded-full"
                  [ngClass]="{ 'text-white border-transparent': isHighlighted(place?.title) }"
                  [ngStyle]="isHighlighted(place?.title) ? { 'background-color': '#852C3A' } : {}"
                >
                  {{ getPlaceIcon(place?.title) }}
                </span>
              </ng-template>
              <div class="flex flex-col min-w-0">
                <div>{{ place?.title }}</div>
                <div class="text-sm text-gray-500 truncate">{{ place?.address }}</div>
              </div>
              <span class="material-symbols-outlined ml-auto p-2 text-[#912338]">arrow_insert</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- ETA and Start Button -->
      <div class="mt-2 flex items-center justify-between z-0">
        <div class="flex items-center text-lg font-bold text-[#912338]">
          <ng-container *ngIf="outdoorDirectionsService as svc">
            <ng-container *ngIf="svc.getSelectedStrategy$() | async as strategy">
              <ng-container [ngSwitch]="strategy.getMode()">
                <span *ngSwitchCase="'WALKING'" class="material-symbols-outlined mr-1">
                  directions_walk
                </span>
                <span *ngSwitchCase="'DRIVING'" class="material-symbols-outlined mr-1">
                  directions_car
                </span>
                <span *ngSwitchCase="'TRANSIT'" class="material-symbols-outlined mr-1">
                  directions_bus
                </span>
                <span *ngSwitchCase="'SHUTTLE'" class="material-symbols-outlined mr-1">
                  directions_transit
                </span>
              </ng-container>
              <span>{{ strategy.getTotalDuration().text || '' }}</span>
              <span class="text-gray-500 font-bold ml-2">
                {{ strategy.getTotalDistance().text || '' }}
              </span>
            </ng-container>
          </ng-container>
        </div>
        <button
          class="bg-[#912338] text-white py-3 px-8 rounded-full text-lg font-semibold"
          [ngClass]="{ 'opacity-50 cursor-not-allowed': disableStart }"
          [disabled]="disableStart"
          (click)="onStartClick()"
        >
          Start
        </button>
      </div>
    </div>
  </div>
</div>
